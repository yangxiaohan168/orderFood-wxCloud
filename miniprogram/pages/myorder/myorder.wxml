<!--pages/myorder/myorder.wxml-->
<view class="page">
  <!-- é¡¶éƒ¨æ ‡ç­¾æ  -->
  <view class="tabs">
    <view 
      class="tab-item {{currentTab === index ? 'active' : ''}}"
      wx:for="{{tabs}}"
      wx:key="index"
      bindtap="switchTab"
      data-index="{{index}}">
      <text class="tab-text">{{item}}</text>
      <view class="tab-line" wx:if="{{currentTab === index}}"></view>
    </view>
  </view>

  <!-- è®¢å•åˆ—è¡¨ -->
  <view class="order-list">
    <view class="order-item" wx:for="{{orderList}}" wx:key="_id">
      <!-- è®¢å•å¤´éƒ¨ -->
      <view class="order-header">
        <view class="order-user-info" wx:if="{{userInfo}}">
          <image class="user-avatar" src="{{userInfo.avatarUrl || '/images/my.png'}}" mode="aspectFill"></image>
          <view class="user-info-text">
            <view class="user-name">{{userInfo.nickName || 'æœªè®¾ç½®æ˜µç§°'}}</view>
            <view class="user-phone" wx:if="{{userInfo.phoneNumber}}">{{userInfo.phoneNumber}}</view>
          </view>
        </view>
        <view class="order-type">
          <text wx:if="{{item.type === 'recharge'}}">ğŸ’° å……å€¼è®¢å•</text>
          <text wx:elif="{{item.orderType === 'dineIn'}}">ğŸ½ï¸ å ‚é£Ÿè®¢å•</text>
          <text wx:elif="{{item.orderType === 'takeOut'}}">ğŸ“¦ æ‰“åŒ…è®¢å•</text>
          <text wx:else>ğŸ½ï¸ ç‚¹é¤è®¢å•</text>
        </view>
        <!-- <view class="order-status {{item.status === 3 ? 'cancel' : ''}}">
          {{item.type === 'recharge' ? 'å·²å®Œæˆ' : (item.status === 0 ? 'å¾…ç¡®è®¤' : item.status === 1 ? 'åˆ¶ä½œä¸­' : item.status === 2 ? 'å·²å®Œæˆ' : 'å·²å–æ¶ˆ')}}
        </view> -->
      </view>

      <!-- å……å€¼è®¢å•å†…å®¹ -->
      <view class="order-content" wx:if="{{item.type === 'recharge'}}">
        <view class="recharge-info">
          <view class="recharge-item">
            <text class="recharge-label">å……å€¼é‡‘é¢ï¼š</text>
            <text class="recharge-value">Â¥{{item.amount}}</text>
          </view>
          <view class="recharge-item">
            <text class="recharge-label">èµ é€é‡‘é¢ï¼š</text>
            <text class="recharge-value gift">Â¥{{item.giveAmount}}</text>
          </view>
          <view class="recharge-item">
            <text class="recharge-label">åˆ°è´¦é‡‘é¢ï¼š</text>
            <text class="recharge-value total">Â¥{{item.totalGet}}</text>
          </view>
        </view>
      </view>

      <!-- ç‚¹é¤è®¢å•å†…å®¹ -->
      <view class="order-content" wx:if="{{item.type === 'order'}}">
        <view class="goods-list">
          <view class="goods-item" wx:for="{{item.goods}}" wx:for-item="goods" wx:key="goodsId">
            <image class="goods-image" src="{{goods.dishImage}}" mode="aspectFill"></image>
            <view class="goods-info">
              <view class="goods-name">{{goods.dishName}}</view>
              <!-- æ˜¾ç¤ºæ ‡ç­¾ -->
              <view class="goods-tags" wx:if="{{goods.tags && goods.tags.length > 0}}">
                <!-- <text class="tag-text" wx:for="{{goods.tags}}" wx:key="index" wx:for-item="tagVal">
                  {{tagVal}}
                </text> -->
                <van-tag type="danger" wx:for="{{goods.tags}}" wx:key="index" wx:for-item="tagVal">{{tagVal}}</van-tag>
              </view>
              <view class="goods-detail">
                <text class="goods-price">Â¥{{goods.price}}</text>
                <text class="goods-count">x{{goods.count}}</text>
              </view>
            </view>
          </view>
        </view>
        
        <!-- å…å•æ ‡è¯† -->
        <view class="miandan-tag" wx:if="{{item.useMiandan}}">
          <text>ğŸ ä½¿ç”¨å…å•æœºä¼š</text>
        </view>
      </view>

      <!-- è®¢å•åº•éƒ¨ -->
      <view class="order-footer">
        <view class="order-info">
          <view class="order-time">
            {{item.createTimeText}}
          </view>
          <view class="order-table-code" wx:if="{{item.tableNumber}}">
            æ¡Œç ï¼š{{item.tableNumber}}
          </view>
        </view>
        <view class="order-actions">
          <view class="order-price">
            <text class="price-label">å®ä»˜ï¼š</text>
            <text class="price-num">Â¥{{item.type === 'recharge' ? item.amount : item.finalPrice}}</text>
          </view>
          <!-- å½“å‰ä¸éœ€è¦è¯¦æƒ…ã€å–æ¶ˆç­‰æŒ‰é’®ï¼Œä¿ç•™ç»“æ„æ–¹ä¾¿åç»­æ‰©å±• -->
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <van-empty wx:if="{{orderList.length === 0}}" description="æš‚æ— è®¢å•" />
    
    <!-- åŠ è½½æ›´å¤šæç¤º -->
    <!-- <view class="load-more" wx:if="{{orderList.length > 0}}">
      <text wx:if="{{!orderHasMore && !loadingOrders}}">æ²¡æœ‰æ›´å¤šäº†</text>
      <text wx:if="{{loadingOrders}}">åŠ è½½ä¸­...</text>
    </view> -->
  </view>
</view>
