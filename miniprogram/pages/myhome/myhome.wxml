<!--pages/myhome/myhome.wxml-->
<view class="page">
  <!-- ç”¨æˆ·å¤´éƒ¨ï¼ˆç»Ÿä¸€å¸ƒå±€ï¼‰ -->
  <view class="user-header">
    <view class="user-main">
      <view class="user-avatar">
        <image src="{{userInfo && userInfo.avatarUrl ? userInfo.avatarUrl : '/images/tabBar/me.png'}}" mode="aspectFill"></image>
      </view>
      <view class="user-detail">
        <view class="user-name" wx:if="{{userInfo.nickName}}">
          {{userInfo && userInfo.nickName ? userInfo.nickName : 'é¤é¥®ä¼šå‘˜'}}
        </view>
        <view class="user-phone" wx:if="{{userInfo && userInfo.phoneNumber}}">
          {{userInfo.phoneNumber}}
        </view>
        <view class="user-phone login-prompt-text" wx:else>
          è¯·å…ˆå®Œå–„ä¸ªäººä¿¡æ¯
        </view>
        <button 
          class="login-btn-inline" 
          wx:if="{{!userInfo || !userInfo.phoneNumber}}"
          bindtap="showAuthModal">
          ç‚¹å‡»å®Œå–„ä¸ªäººä¿¡æ¯
        </button>
      </view>
    </view>
  </view>

  <!-- ä¼šå‘˜ä½™é¢å¡ç‰‡ -->
  <view class="balance-card">
    <view class="balance-item">
      <view class="balance-icon">ğŸ’°</view>
      <view class="balance-content">
        <view class="balance-label">è´¦æˆ·ä½™é¢</view>
        <view class="balance-amount">Â¥{{userInfo.balance || 0}}</view>
      </view>
    </view>
    <view class="balance-item" >
      <view class="balance-icon">ğŸ</view>
      <view class="balance-content">
        <view class="balance-label">å…å•æ¬¡æ•°</view>
        <view class="balance-amount">{{miandanCount}}æ¬¡</view>
      </view>
    </view>
  </view>

  <!-- å……å€¼æŒ‰é’® -->
  <view class="action-card">
    <view class="action-btn-large" bindtap="goToRecharge">
      <text>ğŸ’³ ç«‹å³å……å€¼</text>
    </view>
  </view>

  <!-- åŠŸèƒ½èœå• -->
  <!-- <view class="menu-section">
    <van-grid column-num="2" border="{{false}}" custom-class="service-grid">
      <van-grid-item custom-class="service-item">
        <button class="service-btn" open-type="contact">
          <view class="service-icon">ğŸ’¬</view>
          <view class="service-text">è”ç³»å®¢æœ</view>
        </button>
      </van-grid-item>
      <van-grid-item custom-class="service-item">
        <button class="service-btn" open-type="contact">
          <view class="service-icon">ğŸ“</view>
          <view class="service-text">åœ¨çº¿å’¨è¯¢</view>
        </button>
      </van-grid-item>
    </van-grid>
  </view> -->

  <!-- ç®¡ç†å‘˜å…¥å£è§¦å‘åŒºåŸŸï¼ˆéšè—åœ¨å³ä¸‹è§’ï¼‰ -->
  <view class="admin-trigger" bindtap="onAdminTrigger"></view>

  <!-- å¯†ç è¾“å…¥å¼¹çª— -->
  <view class="modal-mask" wx:if="{{showPasswordModal}}" catchtap="noop">
    <view class="modal-dialog" catchtap="stopPropagation">
      <view class="modal-title">{{isFirstTime ? 'è®¾ç½®ç®¡ç†å‘˜å¯†ç ' : 'ç®¡ç†å‘˜ç™»å½•'}}</view>
      <view class="modal-content">
        <input 
          class="password-input" 
          type="password" 
          placeholder="{{isFirstTime ? 'è¯·è®¾ç½®ç®¡ç†å‘˜å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰' : 'è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç '}}" 
          value="{{adminPassword}}"
          bindinput="onPasswordInput"
        />
        <view class="password-hint" wx:if="{{isFirstTime}}">
          é¦–æ¬¡è®¾ç½®ï¼Œè¯·è®¾ç½®ä¸€ä¸ªå®‰å…¨çš„å¯†ç 
        </view>
      </view>
      <view class="modal-footer">
        <view class="modal-btn cancel" bindtap="closePasswordModal">å–æ¶ˆ</view>
        <view class="modal-btn confirm" bindtap="verifyPassword">{{isFirstTime ? 'è®¾ç½®' : 'ç™»å½•'}}</view>
      </view>
    </view>
  </view>

  <!-- ç”¨æˆ·ä¿¡æ¯æˆæƒç»„ä»¶ -->
  <avatar-nickname-modal 
    showAvaModal="{{showAuthModal}}" 
    bind:saved="onUserInfoSaved">
  </avatar-nickname-modal>

  <!-- ç‰ˆæœ¬å·æ˜¾ç¤º -->
  <view class="version-info">
    <text class="version-text">ç‰ˆæœ¬å·ï¼š{{version}}</text>
  </view>
</view>
