<!--pages/admin/user/user.wxml-->
<view class="page">
  <!-- æœç´¢æ  -->
  <view class="search-bar">
    <input 
      class="search-input" 
      placeholder="æœç´¢ç”¨æˆ·æ˜µç§°æˆ–æ‰‹æœºå·" 
      value="{{searchKeyword}}"
      bindinput="onSearchInput"
      bindconfirm="doSearch"
    />
    <view class="search-btn" bindtap="doSearch">æœç´¢</view>
    <view class="clear-btn" wx:if="{{searchKeyword}}" bindtap="clearSearch">æ¸…ç©º</view>
  </view>

  <!-- ç”¨æˆ·åˆ—è¡¨ -->
  <view class="user-list">
    <view class="user-item" wx:for="{{users}}" wx:key="_id">
      <view class="user-avatar">
        <image wx:if="{{item.avatarUrl}}" src="{{item.avatarUrl}}" mode="aspectFill"></image>
        <view wx:else class="default-avatar">ğŸ‘¤</view>
      </view>
      <view class="user-info">
        <view class="user-name">
          {{item.nickName || 'æœªçŸ¥æ˜µç§°'}}
        </view>
        <view class="user-detail">
          <text>ğŸ“± {{item.phoneNumber || 'æœªç»‘å®šå·ç '}}</text>
        </view>
        <view class="user-detail">
          <text>ğŸ’° ä½™é¢: Â¥{{item.balance || 0}}</text>
        </view>
        <view class="user-detail" wx:if="{{item.miandanCount !== undefined}}">
          <text>ğŸ å…å•æ¬¡æ•°: {{item.miandanCount || 0}}æ¬¡</text>
        </view>
      </view>
      <view class="user-actions">
        <view class="action-btn balance-btn" catchtap="showEditBalanceModal" data-user="{{item}}">ä¿®æ”¹ä½™é¢</view>
        <view class="action-btn miandan-btn" catchtap="showEditMiandanModal" data-user="{{item}}">ä¿®æ”¹å…å•</view>
      </view>
    </view>

    <van-empty wx:if="{{users.length === 0}}" description="æš‚æ— ç”¨æˆ·æ•°æ®" />
  </view>

  <!-- ç¼–è¾‘ä½™é¢å¼¹çª— -->
  <view class="modal-mask" wx:if="{{showBalanceModal}}" catchtap="closeBalanceModal">
    <view class="modal-dialog" catchtap="stopPropagation">
      <view class="modal-title">ä¿®æ”¹ä¼šå‘˜ä½™é¢</view>
      <view class="modal-content">
        <view class="user-preview">
          <view class="preview-avatar">
            <image wx:if="{{currentUser.avatarUrl}}" src="{{currentUser.avatarUrl}}" mode="aspectFill"></image>
            <view wx:else class="default-avatar">ğŸ‘¤</view>
          </view>
          <view class="preview-name">{{currentUser.nickName || 'æœªè®¾ç½®'}}</view>
        </view>

        <view class="form-item">
          <view class="form-label">è´¦æˆ·ä½™é¢</view>
          <input 
            class="form-input" 
            type="digit" 
            placeholder="è¯·è¾“å…¥ä½™é¢" 
            value="{{editBalance}}"
            bindinput="onBalanceInput"
          />
        </view>
      </view>
      <view class="modal-footer">
        <view class="modal-btn cancel" bindtap="closeBalanceModal">å–æ¶ˆ</view>
        <view class="modal-btn confirm" bindtap="saveBalance">ä¿å­˜</view>
      </view>
    </view>
  </view>

  <!-- ç¼–è¾‘å…å•æ¬¡æ•°å¼¹çª— -->
  <view class="modal-mask" wx:if="{{showMiandanModal}}" catchtap="closeMiandanModal">
    <view class="modal-dialog" catchtap="stopPropagation">
      <view class="modal-title">ä¿®æ”¹å…å•æ¬¡æ•°</view>
      <view class="modal-content">
        <view class="user-preview">
          <view class="preview-avatar">
            <image wx:if="{{currentUser.avatarUrl}}" src="{{currentUser.avatarUrl}}" mode="aspectFill"></image>
            <view wx:else class="default-avatar">ğŸ‘¤</view>
          </view>
          <view class="preview-name">{{currentUser.nickName || 'æœªè®¾ç½®'}}</view>
        </view>

        <view class="form-item">
          <view class="form-label">å…å•æ¬¡æ•°</view>
          <input 
            class="form-input" 
            type="number" 
            placeholder="è¯·è¾“å…¥å…å•æ¬¡æ•°" 
            value="{{editMiandanCount}}"
            bindinput="onMiandanCountInput"
          />
        </view>
      </view>
      <view class="modal-footer">
        <view class="modal-btn cancel" bindtap="closeMiandanModal">å–æ¶ˆ</view>
        <view class="modal-btn confirm" bindtap="saveMiandan">ä¿å­˜</view>
      </view>
    </view>
  </view>
</view>

