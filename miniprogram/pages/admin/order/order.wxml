<!--pages/admin/order/order.wxml-->
<view class="page">
  <!-- ç­›é€‰æ  -->
  <view class="filter-bar">
    <van-tabs active="{{orderType}}" bind:change="onChange" color="#e54d42" swipeable="{{false}}">
      <van-tab title="å…¨éƒ¨è®¢å•" />
      <van-tab title="å……å€¼è®¢å•" />
      <van-tab title="ç‚¹é¤è®¢å•" />
    </van-tabs>
    <view class="refresh-bar">
      <view class="refresh-btn" bindtap="refreshOrders">åˆ·æ–°</view>
      <text class="refresh-tip">æ¯ 10 ç§’è‡ªåŠ¨åˆ·æ–°</text>
    </view>
  </view>

  <!-- è®¢å•åˆ—è¡¨ -->
  <view class="order-list">
    <view class="order-item" wx:for="{{orders}}" wx:key="_id">
      <!-- è®¢å•å¤´éƒ¨ -->
      <view class="order-header">
        <view class="order-user-info" wx:if="{{item.userAvatar}}">
          <image class="user-avatar" src="{{item.userAvatar || '/images/my.png'}}" mode="aspectFill"></image>
          <view class="user-info-text">
            <view class="user-name">{{item.userNickName || 'æœªè®¾ç½®æ˜µç§°'}}</view>
            <view class="user-phone" wx:if="{{item.userPhone}}">{{item.userPhone}}</view>
          </view>
        </view>
        <view class="order-type">
          <text wx:if="{{item.type === 'recharge'}}">ğŸ’° å……å€¼è®¢å•</text>
          <text wx:elif="{{item.orderType === 'dineIn'}}">ğŸ½ï¸ å ‚é£Ÿè®¢å•</text>
          <text wx:elif="{{item.orderType === 'takeOut'}}">ğŸ“¦ æ‰“åŒ…è®¢å•</text>
          <text wx:else>ğŸ½ï¸ ç‚¹é¤è®¢å•</text>
        </view>
      </view>

      <!-- å……å€¼è®¢å•å†…å®¹ -->
      <view class="order-content" wx:if="{{item.type === 'recharge'}}">
        <view class="recharge-info">
          <view class="recharge-item">
            <text class="recharge-label">å……å€¼é‡‘é¢ï¼š</text>
            <text class="recharge-value">Â¥{{item.amount}}</text>
          </view>
          <view class="recharge-item">
            <text class="recharge-label">èµ é€é‡‘é¢ï¼š</text>
            <text class="recharge-value gift">Â¥{{item.giveAmount}}</text>
          </view>
          <view class="recharge-item">
            <text class="recharge-label">åˆ°è´¦é‡‘é¢ï¼š</text>
            <text class="recharge-value total">Â¥{{item.totalGet}}</text>
          </view>
        </view>
      </view>

      <!-- ç‚¹é¤è®¢å•å†…å®¹ -->
      <view class="order-content" wx:if="{{item.type === 'order'}}">
        <view class="goods-list">
          <view class="goods-item" wx:for="{{item.goods}}" wx:for-item="goods" wx:key="goodsId">
            <image class="goods-image" src="{{goods.dishImage}}" mode="aspectFill"></image>
            <view class="goods-info">
              <view class="goods-name">{{goods.dishName}}</view>
              <!-- æ˜¾ç¤ºæ ‡ç­¾ -->
              <view class="goods-tags" wx:if="{{goods.tags && goods.tags.length > 0}}">
                <!-- <text class="tag-text" wx:for="{{goods.tags}}" wx:key="index" wx:for-item="tagVal">
                  {{tagVal}}
                </text> -->
                <van-tag type="danger" wx:for="{{goods.tags}}" wx:key="index" wx:for-item="tagVal">{{tagVal}}</van-tag>
              </view>
              <view class="goods-detail">
                <text class="goods-price">Â¥{{goods.price}}</text>
                <text class="goods-count">x{{goods.count}}</text>
              </view>
            </view>
          </view>
        </view>
        
        <!-- å…å•æ ‡è¯† -->
        <view class="miandan-tag" wx:if="{{item.useMiandan}}">
          <text>ğŸ ä½¿ç”¨å…å•æœºä¼š</text>
        </view>
      </view>

      <!-- è®¢å•åº•éƒ¨ -->
      <view class="order-footer">
        <view class="order-info">
          <view class="order-time">
            {{item.createTimeText}}
          </view>
          <view class="order-table-code" wx:if="{{item.tableNumber}}">
            æ¡Œç ï¼š{{item.tableNumber}}
          </view>
          <!-- æ‰“å°çŠ¶æ€ -->
          <view class="order-print-status">
            <text class="print-status-text {{item.printStatus === 2 ? 'printed' : item.printStatus === 3 ? 'failed' : item.printStatus === 4 ? 'cancelled' : 'not-printed'}}">
              {{item.printStatus === 2 ? 'âœ… å·²æ‰“å°å°ç¥¨' : item.printStatus === 3 ? 'âŒ æ‰“å°å¤±è´¥' : item.printStatus === 4 ? 'ğŸš« æ‰“å°å·²å–æ¶ˆ' : 'â³ æœªæ‰“å°å°ç¥¨'}}
            </text>
          </view>
        </view>
        <view class="order-actions">
          <view class="order-price">
            <text class="price-label">å®ä»˜ï¼š</text>
            <text class="price-num">Â¥{{item.type === 'recharge' ? item.amount : item.finalPrice}}</text>
          </view>
          <view class="action-btns">
            <!-- <view class="action-btn delete" bindtap="deleteOrder" data-order="{{item}}" catchtap="stopPropagation">åˆ é™¤</view> -->
          </view>
        </view>
      </view>
    </view>

    <van-empty wx:if="{{orders.length === 0}}" description="æš‚æ— è®¢å•æ•°æ®" />
  </view>

</view>

