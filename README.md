
https://open.trenditiot.com 打印机申请appid地址
# 餐饮点餐小程序

一个基于微信云开发的餐饮店点餐小程序，支持会员充值、在线点餐、余额支付、免单机会等功能。

## 功能特点

### 🎯 核心功能

1. **会员充值系统**
   - 充值即成为会员
   - 充值金额1:1赠送等额余额
   - 单笔充值满68元，额外赠送1次免单机会
   - 多种充值套餐可选

2. **在线点餐**
   - 菜品分类浏览
   - 购物车管理
   - 余额支付
   - 免单机会使用

3. **订单管理**
   - 查看点餐订单
   - 查看充值记录
   - 订单状态跟踪
   - 取消待确认订单

4. **个人中心**
   - 余额查询
   - 免单次数显示
   - 订单统计
   - 会员信息

### 🎨 设计特色

- ❤️ 红色主题，温馨大气
- 📱 简洁现代的UI设计
- 🚀 流畅的用户体验
- 💫 精美的动画效果

## 技术栈

- **前端**：微信小程序原生开发
- **后端**：微信云开发（云函数 + 云数据库）
- **UI框架**：ColorUI（部分组件）

## 项目结构

```
diancang/
├── cloudfunctions/          # 云函数目录
│   ├── login/              # 登录获取openid
│   ├── getCategory/        # 获取菜品分类
│   ├── getGoods/           # 获取菜品列表
│   ├── createOrder/        # 创建点餐订单
│   └── doRecharge/         # 执行充值操作
├── miniprogram/            # 小程序目录
│   ├── pages/              # 页面目录
│   │   ├── index/         # 首页（点餐）
│   │   ├── recharge/      # 充值页面
│   │   ├── myorder/       # 订单页面
│   │   └── myhome/        # 个人中心
│   ├── components/         # 组件目录
│   ├── images/            # 图片资源
│   ├── app.js             # 小程序入口
│   ├── app.json           # 全局配置
│   └── app.wxss           # 全局样式
└── DATABASE_DESIGN.md      # 数据库设计文档
```

## 数据库设计

### 数据库集合

1. **user** - 用户表
2. **menu** - 菜品分类表
3. **goods** - 菜品表
4. **order** - 订单表（包含点餐订单和充值订单）
5. **recharge** - 充值套餐表
6. **miandan** - 免单记录表

详细的数据库设计请查看 [DATABASE_DESIGN.md](./DATABASE_DESIGN.md)

## 快速开始

### 1. 环境要求

- 微信开发者工具
- 已开通微信云开发

### 2. 配置步骤

#### 2.1 克隆项目

```bash
git clone [项目地址]
cd diancang
```

#### 2.2 配置云开发环境

1. 在微信开发者工具中打开项目
2. 开通云开发，创建云环境
3. 获取云环境ID
4. 修改以下文件中的环境ID：
   - `miniprogram/app.js` (第16行)
   - 所有云函数的 `index.js` 文件

```javascript
// 将 '填写你的环境ID' 替换为你的环境ID
cloud.init({ env: '你的云环境ID' })
```

#### 2.3 创建数据库集合

在云开发控制台创建以下集合：

- user
- menu
- goods
- order
- recharge
- miandan

#### 2.4 初始化数据

##### 创建菜品分类（menu集合）

```json
[
  { "name": "热菜", "sort": 1, "status": 1 },
  { "name": "凉菜", "sort": 2, "status": 1 },
  { "name": "主食", "sort": 3, "status": 1 },
  { "name": "饮品", "sort": 4, "status": 1 }
]
```

##### 创建充值套餐（recharge集合）

```json
[
  { "amount": 50, "giftAmount": 50, "sort": 1, "status": 1 },
  { "amount": 68, "giftAmount": 68, "sort": 2, "status": 1 },
  { "amount": 100, "giftAmount": 100, "sort": 3, "status": 1 },
  { "amount": 200, "giftAmount": 200, "sort": 4, "status": 1 }
]
```

##### 创建示例菜品（goods集合）

```json
{
  "menuId": "获取menu集合的_id",
  "name": "宫保鸡丁",
  "image": "上传图片到云存储获取URL",
  "price": 28,
  "desc": "经典川菜，酸甜可口",
  "sort": 1,
  "status": 1
}
```

#### 2.5 上传云函数

在微信开发者工具中，右键每个云函数目录：
1. 云函数 → 上传并部署：云端安装依赖

需要上传的云函数：
- login
- getCategory
- getGoods
- createOrder
- doRecharge

#### 2.6 配置数据库权限

在云开发控制台 → 数据库 → 集合权限，配置以下权限：

- **user**：仅创建者可读写
- **menu**：所有用户可读，仅管理员可写
- **goods**：所有用户可读，仅管理员可写
- **order**：仅创建者可读写
- **recharge**：所有用户可读，仅管理员可写
- **miandan**：仅创建者可读写

### 3. 运行项目

1. 在微信开发者工具中打开项目
2. 点击"编译"按钮
3. 在模拟器中测试功能

## 业务逻辑说明

### 充值流程

1. 用户选择充值套餐
2. 确认充值后：
   - 增加用户余额 = 充值金额 + 赠送金额
   - 用户成为会员
   - 充值≥68元，赠送1次免单机会
3. 生成充值订单记录

### 点餐流程

1. 浏览菜品，加入购物车
2. 点击结算，检查余额
3. 如果有免单机会，询问是否使用
4. 创建订单并扣除余额/免单次数
5. 订单状态：待确认 → 制作中 → 已完成

### 免单机制

- 充值满68元赠送1次免单机会
- 使用免单时，订单金额为0
- 免单次数存储在 miandan 集合中
- 取消使用免单的订单会退回免单次数

## 主要页面说明

### 首页（点餐页面）

- 显示菜品分类
- 展示菜品列表
- 购物车功能
- 余额显示
- 下单结算

### 充值页面

- 显示当前余额
- 展示充值套餐
- 充值说明
- 会员权益介绍

### 订单页面

- 显示全部订单
- 点餐订单详情
- 充值订单记录
- 订单状态跟踪
- 取消订单功能

### 个人中心

- 用户信息展示
- 余额显示
- 免单次数
- 订单统计
- 功能菜单

## 注意事项

1. **价格单位**：所有价格字段统一使用元为单位
2. **图片存储**：菜品图片建议上传到云存储
3. **会员机制**：充值即成为会员，无需打折（已通过赠送余额体现优惠）
4. **免单规则**：单笔充值满68元赠送1次免单机会
5. **余额支付**：点餐时优先使用免单，否则使用余额支付

## 后续优化建议

1. **管理后台**
   - 菜品管理
   - 订单管理
   - 会员管理
   - 数据统计

2. **功能扩展**
   - 菜品评价
   - 优惠券系统
   - 积分系统
   - 桌号管理

3. **支付对接**
   - 微信支付
   - 其他支付方式

4. **通知功能**
   - 订单状态通知
   - 充值到账通知
   - 优惠活动通知

## 常见问题

### Q1: 如何添加菜品？

A: 在云开发控制台 → 数据库 → goods集合中手动添加，或开发管理后台。

### Q2: 如何修改充值规则？

A: 在 recharge 集合中修改套餐配置，免单规则在云函数 `doRecharge` 中修改（目前是68元）。

### Q3: 用户余额不足怎么办？

A: 系统会自动提示用户充值，并引导跳转到充值页面。

### Q4: 如何查看订单？

A: 商家可以在云开发控制台查看 order 集合，或开发管理后台进行订单管理。

## 开发团队

- 项目类型：小本买卖餐饮点餐系统
- 技术支持：微信云开发
- 设计风格：红色主题

## 许可证

本项目仅供学习交流使用。

## 联系方式

如有问题，欢迎提Issue或联系开发者。

---

**祝生意兴隆！** 🎉
